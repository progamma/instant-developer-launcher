{"version":3,"file":"insets.js","sources":["../src/www/Inset.ts","../src/www/InsetMask.ts"],"sourcesContent":["/*\n   Copyright 2022-2024 Total Pave Inc.\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n*/\n\nimport {IInsetConfiguration} from './IInsetConfiguration';\nimport {IInsetCallbackFunc} from './IInsetCallbackFunc';\nimport {IInset} from './IInset';\n\nexport const SERVICE_NAME: string = \"Inset\";\n\ninterface IInsetEvent<T = unknown> {\n    type: 'init' | 'update';\n    data: T;\n}\n\ntype IInsetInitEvent = IInsetEvent<string>;\ninterface IInsetUpdateEvent extends IInsetEvent<IInset> {\n    id: string;\n}\n\nexport class Inset {\n    private $currentInset: IInset;\n    private $listeners: IInsetCallbackFunc[];\n    private $id: string;\n\n    private constructor() {\n        this.$id = null;\n        this.$listeners = [];\n        this.$currentInset = {\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0\n        };\n    }\n\n    /**\n     * Gets the native identifier\n     * \n     * @returns \n     */\n    public getID(): string {\n        return this.$id;\n    }\n\n    /**\n     * Gets the last emitted inset information\n     * \n     * @returns\n     */\n    public getInsets(): IInset {\n        console.warn('getInsets() is deprecated, use getInset instead()', new Error().stack);\n        return this.getInset();\n    }\n\n    public getInset(): IInset {\n        return this.$currentInset;\n    }\n\n    /**\n     * See the static Inset.free method for details\n     * \n     * This is the equivilant of calling Inset.free(insetInstance)\n     * \n     * @returns \n     */\n    public async free(): Promise<void> {\n        return await Inset.free(this);\n    }\n\n    /**\n     * Adds a listener to this inset configuration.\n     * \n     * Note that this may fire even if nothing has actually\n     * changed.\n     * \n     * Retain the listener reference to remove it later if\n     * necessary.\n     * \n     * @param listener \n     */\n    public addListener(listener: IInsetCallbackFunc): void {\n        this.$listeners.push(listener);\n        listener(this.$currentInset);\n    }\n\n    /**\n     * Frees the listener reference\n     * \n     * @param listener \n     */\n    public removeListener(listener: IInsetCallbackFunc): void {\n        let idx: number = this.$listeners.indexOf(listener);\n        if (idx > -1) {\n            this.$listeners.splice(idx, 1);\n        }\n    }\n\n    private $onUpdate(insets: IInset): void {\n        this.$currentInset = insets;\n\n        for (let i = 0; i < this.$listeners.length; i++) {\n            this.$listeners[i](insets);\n        }\n    }\n\n    private static $generateID(): string {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n            const r = Math.random() * 16 | 0,\n                v = c === 'x' ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    }\n\n    /**\n     * Configures a new Inset instance to listen for inset changes\n     * It's valid to have multiple instances, with different configurations\n     * Each instance may have 0-to-many listeners attached via addListener\n     * \n     * If this instance is no longer needed/used, call `free` to free\n     * resources.\n     * \n     * It will be more performant to keep the instance count low. If only one\n     * configuration set is needed, then it would be recommended to create a\n     * single instance and share it rather than every object having it's own\n     * inset listener instance.\n     * \n     * @param config \n     * @returns \n     */\n    public static create(config: IInsetConfiguration): Promise<Inset> {\n        return new Promise<Inset>((resolve, reject) => {\n            if (!config) {\n                config = {};\n            }\n\n            if (cordova.platformId === 'ios') {\n                let instance: Inset = new Inset();\n                instance.$id = Inset.$generateID();\n                resolve(instance);\n                return;\n            }\n\n            let inset: Inset = new Inset();\n\n            cordova.exec(\n                (e: IInsetEvent) => {\n                    if (Inset.$isInitEvent(e)) {\n                        inset.$id = e.data;\n                        resolve(inset);\n                    }\n                    else if (Inset.$isUpdateEvent(e)) {\n                        inset.$onUpdate(e.data);\n                    }\n                },\n                reject,\n                SERVICE_NAME,\n                \"create\",\n                [config]\n            );\n        });\n    }\n\n    /**\n     * Frees the native resources associated with the given\n     * inset.\n     * \n     * After freeing, the inset is no longer usable and it will\n     * not receive anymore inset updates. If you retain any\n     * references to inset listeners, they should also be dereferenced\n     * to allow for garbage collection.\n     * \n     * This is the equivilant of calling `await inset.free()`\n     * \n     * @param inset \n     * @returns \n     */\n    public static free(inset: Inset | string): Promise<void> {\n        let id: string = null;\n\n        if (typeof inset === 'string') {\n            id = inset;\n        }\n        else {\n            id = inset.getID();\n        }\n\n        return new Promise<void>((resolve, reject) => {\n            if (cordova.platformId === 'ios') {\n                resolve();\n                return;\n            }\n\n            cordova.exec(\n                () => {\n                    resolve();\n                },\n                reject,\n                SERVICE_NAME,\n                \"delete\",\n                [id]\n            );\n        });\n    }\n\n    private static $isInitEvent(e: IInsetEvent): e is IInsetInitEvent {\n        return e.type === 'init';\n    }\n\n    private static $isUpdateEvent(e: IInsetEvent): e is IInsetUpdateEvent {\n        return e.type === 'update';\n    }\n}\n\ndeclare global {\n    interface ITotalpave {\n        Inset: Inset;\n    }\n    interface Window {\n        totalpave: ITotalpave;\n    }\n}\n","/*\n   Copyright 2022 Total Pave Inc.\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n*/\n\n/**\n * An enumeration of Inset Types.\n * These are mapped to android's native WindowInsetsCompat.TYPE\n * \n * See https://developer.android.com/reference/androidx/core/view/WindowInsetsCompat.Type\n * for more information.\n * \n * Note that the native constant values is an implementation detail,\n * therefore the values here isn't a direct mapping, but will be resolved\n * appropriately.\n */\nexport enum InsetMask {\n    CAPTION_BAR                 = 1,\n    DISPLAY_CUTOUT              = 1 << 1,\n    IME                         = 1 << 2,\n    MANDATORY_SYSTEM_GESTURES   = 1 << 3,\n    NAVIGATION_BARS             = 1 << 4,\n    STATUS_BARS                 = 1 << 5,\n    SYSTEM_BARS                 = 1 << 6,\n    SYSTEM_GESTURES             = 1 << 7,\n    TAPPABLE_ELEMENT            = 1 << 8\n};\n"],"names":["InsetMask"],"mappings":"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"}